<!doctype html>
<html lang="en">

<head>
    <title>Title</title>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Bootstrap CSS v5.2.1 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-main px-3">
        <div class="container">
            <!-- Logo -->
            <a class="navbar-brand fw-bold" href="/">
                <img src="/images/book.jpeg" alt="Logo" height="60">
            </a>

            <!-- Search Bar -->
            <form class="d-flex search-bar mx-auto" action="/movies/search" method="get">
                <input class="form-control me-2" type="search" name="q"
                    placeholder="Search for Movies, Events, Plays, Sports and Activities" aria-label="Search">
                <button class="btn btn-outline-primary" type="submit">Search</button>
            </form>

            <!-- Right Side -->
            <div class="dropdown me-3">
                <a id="locationDropdown" class="dropdown-toggle text-dark text-decoration-none" href="#" role="button"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    Location
                </a>
                <ul class="dropdown-menu" id="locationMenu">
                    <li><a class="dropdown-item" href="#">Detecting...</a></li>
                </ul>
            </div>

            <!-- Sign In Button -->
            <% if (user && user.username) { %>
                <span>Welcome, <%= user.username %>!</span>
                <a href="/auth/logout" class="btn btn-outline-danger ms-2">Logout</a>
                <% } else { %>
                    <a href="#" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#authModal">Sign
                        In</a>
                    <% } %>
                        <!-- Menu Icon -->
                        <button class="btn btn-light border-0">
                            <span class="navbar-toggler-icon"></span>
                        </button>
        </div>
        </div>
    </nav>

    <!-- Secondary Navbar -->
    <div class="secondary-nav py-1 px-3 d-flex justify-content-between container">
        <div>
            <a href="#">Movies</a>
            <a href="#">Stream</a>
            <a href="#">Events</a>
            <a href="#">Plays</a>
            <a href="#">Sports</a>
            <a href="#">Activities</a>
        </div>
        <div>
            <a href="#">ListYourShow</a>
            <a href="#">Corporates</a>
            <a href="#">Offers</a>
            <a href="#">Gift Cards</a>
        </div>
    </div>
    <!-- Bootstrap JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
        integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
        crossorigin="anonymous"></script>

    <script>
        async function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (pos) => {
                    const lat = pos.coords.latitude;
                    const lon = pos.coords.longitude;

                    try {
                        const response = await fetch(
                            `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`
                        );
                        const data = await response.json();

                        // Try multiple fallbacks for city/town/village
                        const city =
                            data.address.city ||
                            data.address.town ||
                            data.address.village ||
                            data.address.hamlet ||
                            data.address.county ||
                            data.address.state ||
                            "Unknown";

                        // Update dropdown
                        document.getElementById("locationDropdown").textContent = city;
                        document.getElementById("locationMenu").innerHTML = `
            <li><a class="dropdown-item" href="#">${city}</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#">Mumbai</a></li>
            <li><a class="dropdown-item" href="#">Delhi</a></li>
            <li><a class="dropdown-item" href="#">Bangalore</a></li>
          `;
                    } catch (err) {
                        document.getElementById("locationMenu").innerHTML = `<li><a class="dropdown-item" href="#">Error fetching location</a></li>`;
                    }
                }, () => {
                    document.getElementById("locationMenu").innerHTML = `<li><a class="dropdown-item" href="#">Location access denied</a></li>`;
                });
            } else {
                document.getElementById("locationMenu").innerHTML = `<li><a class="dropdown-item" href="#">Geolocation not supported</a></li>`;
            }
        }

        getLocation();
    </script>

</body>

</html>